version: "3.1"

rules:
- rule: Activate form
  steps:
  - intent: item_start_generic
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: greet
  steps:
  - intent: welcome_greet
  - action: utter_welcome_greet


- rule: submit form
  condition:
    - active_loop: pizza_order_form
  steps:
      - action: pizza_order_form      # run the form
      - active_loop: null
      - action: action_confirm_pizzas


- rule: out-of-scope
  steps:
  - intent: out_of_scope
  - action: utter_out_of_scope

- rule: start
  steps:
    - intent: init_request
    - action: utter_init_request


- rule: where are you?
  steps:
    - intent: request_restaurant_location
    - action: action_get_restaurant_location
    - action: utter_inform_restaurant_location
    - action: utter_anything_else

- rule: pizza questions
  steps:
    - intent: request_pizza_types
    - action: action_get_pizza_types

- rule: crust questions
  steps:
    - intent: request_pizza_crusts
    - action: utter_inform_pizza_crust

- rule: size questions
  steps:
    - intent: request_pizza_sizes
    - action: utter_inform_pizza_size

- rule: anti pizza
  steps:
    - intent: order_anti_pizza
    - slot_was_set:
      - anti_pizza_type: "true"
    - action: utter_anti_pizza
    - action: action_get_pizza_types

- rule: explain pizza amount
  condition:
  - active_loop: pizza_order_form
  - slot_was_set:
    - requested_slot: pizza_amount
  steps:
  - intent: explain
  - action: utter_explain_pizza_quantities
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: explain pizza types
  condition:
  - active_loop: pizza_order_form
  - slot_was_set:
    - requested_slot: pizza_type
  steps:
  - intent: explain
  - action: utter_explain_pizza_types
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: explain pizza size
  condition:
  - active_loop: pizza_order_form
  - slot_was_set:
    - requested_slot: pizza_size
  steps:
  - intent: explain
  - action: utter_explain_pizza_size
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: explain pizza crust
  condition:
  - active_loop: pizza_order_form
  - slot_was_set:
    - requested_slot: pizza_crust
  steps:
  - intent: explain
  - action: utter_explain_pizza_crust
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: explain pizza sliced
  condition:
  - active_loop: pizza_order_form
  - slot_was_set:
    - requested_slot: pizza_sliced
  steps:
  - intent: explain
  - action: utter_explain_pizza_sliced
  - action: pizza_order_form
  - active_loop: pizza_order_form

- rule: Goodbye
  steps:
  - intent: goodbye
  - action: utter_goodbye

# - rule: stop pizza form
#   condition:
#   - active_loop: pizza_order_form
#   steps:
#   - intent: stop_order
#   - action: utter_ask_confirm
#   - or:
#     - intent: response_positive
#     - intent: stop_order
#   - action: action_deactivate_loop
#   - active_loop: null
#   - action: action_reset_pizza_form
#   - action: utter_confirm_order_canceled
#   - action: utter_anything_else